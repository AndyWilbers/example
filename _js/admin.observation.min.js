var observation={setup:function(){observation.setup_observation_ar_form()},setup_observation_ar_form:function(){if(1==$("#observation-ar").size()){$(document).on("click",'[data-ce*="name:type;"]',function(){$(this).parents("nav.tab").addClass("active").siblings().removeClass("active");var t=ce.data($(this).attr("data-ce")),a=t.value;$('.tab-container[data-sa*="name:type;"]').addClass("hide").filter('[data-sa*="'+a+':y;"]').removeClass("hide"),"radio"==a?$('[data-ce*="name:is_default"]').removeClass("hidden"):$('[data-ce*="name:is_default"]').addClass("hidden")}),$(document).on("click",'form[id] [data-sa="reload"]',function(){$("tr.remove").each(function(){var t=$(this).find('[data-sa*="onClick:observation.option_remove;"]'),a=t.text(),e=t.attr("title");t.text(t.attr("data-label")),t.attr("title",t.attr("data-title")),t.attr("data-label",a),t.attr("data-title",e),$(this).removeClass("remove")}),$($('input[name="options_to_delete"]')).val("")});var t=form.data.get($("#observation-ar")),a={};$.each(t,function(t,e){var n=t.split("_");if(0==$('[name="'+t+'"]').size()&&"opt"===n[0]){var o=n[2];a.hasOwnProperty(o)||(a[o]={});var i=n[1];a[o][i]=e}});var e=sa.dataSA($("html").eq(0).attr("data-sa")),n=new gen.ajax("");n.get({url:e.application+"/observation/options_get_rows",data:a,callback:"observation.option_add_new_rows"})}},option_add_new_rows:function(t){for(var a=form.data.get($("#observation-ar")),e=0;e<t.rows.length;e++){var n=$("#observation_opt").find("tbody");0==n.find("tr").size()?n.html(t.rows[e].html):n.find("tr:last").after(t.rows[e].html),n.find("tr:last").addClass("new"),n.find('tr:last input[type="text"]').trigger("change")}$.each($("#observation_opt").find('[data-ce*="name:is_default;"]'),function(){var t=ce.data($(this).attr("data-ce"));a.hasOwnProperty(t.name)&&t.value==a[t.name]&&($(this).hasClass("checked")||$(this).trigger("click"))});var o=ce.data($('[data-ce*="name:type;"].checked').attr("data-ce"));if("radio"==o.value?$('[data-ce*="name:is_default"]').removeClass("hidden"):$('[data-ce*="name:is_default"]').addClass("hidden"),a.hasOwnProperty("options_to_delete"))for(var i=a.options_to_delete.split(";"),e=0;e<i.length;e++){var r=$("#observation_opt").find('[name="opt_name_'+i[e]+'"]').parents("tr");r.addClass("remove");var s=r.find('[data-sa*="onClick:observation.option_remove;"]'),d=s.text(),l=s.attr("title");s.text(s.attr("data-label")),s.attr("title",s.attr("data-title")),s.attr("data-label",d),s.attr("data-title",l)}},save_callback:function(t){window.console.info(t.redirect)},option_new:function(t){var a=$("#observation_opt"),e=null;a.find('input[name*="opt_position"]').each(function(){var t=parseFloat($(this).val());null==e&&(e=t),t>e&&(e=t)}),t.position_max=e,t.position_row=100*(parseInt(a.find('input[name*="opt_position"]').size(),10)+1);var n=sa.dataSA($("html").eq(0).attr("data-sa")),o=new gen.ajax("");o.get({url:n.application+"/observation/options_get_row",data:t,callback:"observation.option_add_new_row"})},option_add_new_row:function(t){var a=$("#observation_opt").find("tbody");0==a.find("tr").size()?(a.html(t.html_row),a.find("tr:last").find('[data-ce*="is_default"]').trigger("click")):a.find("tr:last").after(t.html_row),a.find("tr:last").addClass("new"),a.find('tr:last input[type="text"]').trigger("change");var e=ce.data($('[data-ce*="name:type;"].checked').attr("data-ce"));"radio"==e.value?$('[data-ce*="name:is_default"]').removeClass("hidden"):$('[data-ce*="name:is_default"]').addClass("hidden")},option_remove:function(t){t.me.parents("tr").toggleClass("remove");var a=t.me.text(),e=t.me.attr("title");t.me.text(t.me.attr("data-label")),t.me.attr("title",t.me.attr("data-title")),t.me.attr("data-label",a),t.me.attr("data-title",e);var n="",o="";$('input[name*="opt_name"]').each(function(){if($(this).parents("tr").hasClass("remove")){var t=$(this).attr("name");n+=o+t.replace("opt_name_",""),o=";"}}),$('input[name="options_to_delete"]').val(n),$('input[name="options_to_delete"]').trigger("change")}};